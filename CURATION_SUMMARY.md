# 🤖 AI 콘텐츠 큐레이션 시스템 - 구현 완료 요약

## 📋 시스템 개요

**요구사항 (사용자):**
> "각 게시판의 아카이빙 된 정보들은 크롤링을 통해 무작위로 끌어 오는게 아니라 **비슷한 것은 합하고 그 중에서 중요한 것만 추려서 관련 자료를 링크하고 요약 정리를 해주는 형태여야 해**."

**구현 완료:**
✅ 크롤링된 대량 콘텐츠를 AI로 자동 분석  
✅ 유사한 콘텐츠 자동 그룹화 (OpenAI Embeddings)  
✅ 중요한 것만 선별 (GPT-4 중요도 평가)  
✅ 여러 출처를 하나의 통합 요약으로 생성  
✅ 관련 자료 자동 링크 (설계 완료, DB 구조 구축)  

---

## 🎯 핵심 기능

### 1. 유사 콘텐츠 자동 그룹화
- **기술**: OpenAI Embeddings API (text-embedding-3-small)
- **방식**: 의미론적 유사도 계산 (코사인 유사도)
- **임계값**: 85% 이상 유사도
- **효과**: 5개의 기초연금 인상 기사 → 1개의 큐레이션 콘텐츠

### 2. 중요도 자동 평가
- **기술**: GPT-4o-mini
- **평가 기준**:
  - 정책적 영향도 (얼마나 많은 사람에게 영향?)
  - 시급성 (긴급하게 알려야 하나?)
  - 실용성 (실생활에 도움?)
  - 신규성 (새로운 정책/제도?)
- **점수**: 1-10점 (기본값: 5점 이상만 표시)

### 3. 통합 요약 자동 생성
- **기술**: GPT-4o-mini
- **형식**: 3-5문장, 핵심만 간결하게
- **포함 내용**:
  - 주요 변경사항
  - 신청 방법, 대상, 일정
  - 실용 정보
- **주요 포인트**: 3-5개 자동 추출

### 4. 관련 자료 자동 링크
- **설계 완료**: `related_contents` 테이블 구축
- **연결 방식**: 태그 기반 유사도 (향후 임베딩 기반으로 업그레이드)
- **카테고리 간 연결**: 정책동향 ↔ 학술정보 ↔ 사회서비스원

---

## 📊 데이터 흐름

```
┌──────────────────────────────────────────────────────────────┐
│  1. 크롤링 시스템 (기존)                                        │
│     - Puppeteer/Cheerio로 웹사이트 크롤링                      │
│     - 보건복지부, 경기도, 사회서비스원 등                       │
└──────────────────┬───────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────┐
│  2. raw_crawled_contents 테이블                                │
│     - 크롤링된 원본 데이터 저장                                 │
│     - is_processed = FALSE (미처리)                           │
└──────────────────┬───────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────┐
│  3. AI 큐레이션 파이프라인 (npm run curate)                     │
│                                                                │
│  [Step 1] OpenAI Embeddings                                   │
│     - 각 콘텐츠의 의미 벡터 생성 (1536차원)                     │
│                                                                │
│  [Step 2] 유사도 계산 & 그룹화                                  │
│     - 코사인 유사도 계산                                        │
│     - 85% 이상 유사하면 같은 그룹으로 병합                       │
│     - 예: 5개 기사 → 1개 그룹                                  │
│                                                                │
│  [Step 3] 중요도 평가 (GPT-4)                                  │
│     - 각 그룹의 중요도 1-10점 평가                              │
│     - 5점 미만은 제외 (사용자 설정 가능)                         │
│                                                                │
│  [Step 4] 통합 요약 생성 (GPT-4)                               │
│     - 그룹 내 모든 콘텐츠를 하나의 요약으로 통합                 │
│     - 주요 포인트 3-5개 추출                                    │
│                                                                │
│  [Step 5] 관련 콘텐츠 링크                                      │
│     - 다른 카테고리에서 관련 자료 검색                           │
│     - 태그 기반 유사도 계산 (향후 임베딩 기반)                   │
└──────────────────┬───────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────┐
│  4. curation_groups 테이블                                     │
│     - 큐레이션 그룹 메타데이터 저장                             │
│     - 그룹 ID, 제목, 주제, 중요도, 요약 등                      │
└──────────────────┬───────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────┐
│  5. contents 테이블 (최종 표시 데이터)                          │
│     - 큐레이션된 최종 콘텐츠 저장                               │
│     - is_curated = TRUE                                       │
│     - importance_score, ai_summary, key_points               │
│     - source_count, original_content_ids                     │
└──────────────────┬───────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────┐
│  6. related_contents 테이블                                    │
│     - 콘텐츠 간 관련성 연결                                     │
│     - 유사도, 관계 타입 저장                                    │
└──────────────────┬───────────────────────────────────────────┘
                   │
                   ▼
┌──────────────────────────────────────────────────────────────┐
│  7. 사용자에게 표시                                             │
│     - 게시판별로 큐레이션된 콘텐츠 표시                          │
│     - 중요도 배지, 원본 출처 링크, 관련 자료 표시                │
└──────────────────────────────────────────────────────────────┘
```

---

## 🗂️ 데이터베이스 구조

### 1. `raw_crawled_contents` (원본 크롤링 데이터)
```sql
CREATE TABLE raw_crawled_contents (
  id UUID PRIMARY KEY,
  title VARCHAR(500),
  summary TEXT,
  full_content TEXT,
  category VARCHAR(50),        -- academy, policy, etc.
  source VARCHAR(100),
  source_url TEXT,
  published_at TIMESTAMP,
  crawled_at TIMESTAMP,
  tags TEXT[],
  is_processed BOOLEAN DEFAULT FALSE,  -- 큐레이션 처리 완료 여부
  curation_group_id UUID               -- 속한 큐레이션 그룹
);
```

### 2. `curation_groups` (큐레이션 그룹)
```sql
CREATE TABLE curation_groups (
  id UUID PRIMARY KEY,
  title VARCHAR(500),           -- 그룹 대표 제목
  theme VARCHAR(200),            -- 주제 (예: 기초연금, 노인돌봄)
  category VARCHAR(50),
  importance_score INTEGER,      -- 1-10 중요도
  ai_summary TEXT,               -- AI 통합 요약
  key_points TEXT[],             -- 주요 포인트
  content_count INTEGER,         -- 통합된 원본 수
  source_urls TEXT[],            -- 원본 URL들
  tags TEXT[],
  created_at TIMESTAMP,
  updated_at TIMESTAMP
);
```

### 3. `contents` 테이블 확장 (최종 표시)
```sql
ALTER TABLE contents ADD COLUMN curation_group_id UUID;
ALTER TABLE contents ADD COLUMN importance_score INTEGER CHECK (importance_score BETWEEN 1 AND 10);
ALTER TABLE contents ADD COLUMN is_curated BOOLEAN DEFAULT FALSE;
ALTER TABLE contents ADD COLUMN ai_summary TEXT;
ALTER TABLE contents ADD COLUMN key_points TEXT[];
ALTER TABLE contents ADD COLUMN source_count INTEGER DEFAULT 1;
ALTER TABLE contents ADD COLUMN original_content_ids UUID[];
```

### 4. `related_contents` (관련 콘텐츠 링크)
```sql
CREATE TABLE related_contents (
  content_id UUID,
  related_content_id UUID,
  relation_type VARCHAR(50),     -- similar, related, referenced
  similarity_score FLOAT,        -- 0-1
  PRIMARY KEY (content_id, related_content_id)
);
```

---

## 🚀 사용 방법

### 1. 데이터베이스 스키마 설치
```bash
psql -U postgres -d welfare_trends -f lib/curation-schema.sql
```

### 2. 환경 변수 설정
```bash
# .env.local
DATABASE_URL=postgresql://postgres:password@localhost:5432/welfare_trends
OPENAI_API_KEY=sk-proj-...your-key...
```

### 3. 샘플 데이터 생성 (테스트용)
```bash
npm run seed:sample
```

### 4. 큐레이션 실행
```bash
# 전체 카테고리 처리
npm run curate

# 정책동향만 처리
npm run curate:policy

# 테스트 모드 (20개 제한)
npm run curate:test
```

### 5. 고급 옵션
```bash
# 카테고리 지정
npm run curate -- --category=policy

# 처리 개수 제한
npm run curate -- --limit=50

# 유사도 임계값 조정
npm run curate -- --similarity=0.90

# 최소 중요도 설정
npm run curate -- --min-importance=7
```

---

## 📊 실행 결과 예시

### 입력 (샘플 데이터)
```
10개의 크롤링 기사:

[정책동향]
1. "2026년 기초연금 월 40만원으로 인상 확정" (보건복지부)
2. "기초연금 40만원 시대...내년 1월부터 시행" (기획재정부)
3. "[속보] 기초연금 40만원 인상, 665만 노인 혜택" (연합뉴스)
4. "경기도, 기초연금 인상 환영...추가 지원 검토" (경기도)
5. "노인단체, 기초연금 40만원 인상 '늦었지만 환영'" (대한노인회)

6. "독거노인 맞춤돌봄서비스 대상 확대" (보건복지부)
7. "노인돌봄 종합서비스, 이용자 만족도 90% 돌파" (보건복지부)
8. "서울시, 24시간 노인 응급돌봄 서비스 시작" (서울시)

[사회서비스원]
9. "[채용] 경기도사회서비스원 2026년 상반기 신규 직원 채용" (경기도사회서비스원)
10. "경기도사회서비스원, 2025년 우수 돌봄기관 선정" (경기도사회서비스원)
```

### 출력 (큐레이션 결과)
```
3개의 큐레이션 콘텐츠:

┌─────────────────────────────────────────────────────────────┐
│ ⭐ 중요도: 9/10   📅 2025-12-20 ~ 2025-12-22                │
│                                                              │
│ 【정책】 2026년 기초연금 월 40만원으로 인상                  │
│                                                              │
│ 💡 AI 통합 요약:                                             │
│ 정부가 2026년 1월부터 기초연금을 현행 33만3천원에서         │
│ 40만원으로 인상한다. 이는 7년 만의 대폭 인상으로            │
│ 65세 이상 소득 하위 70% 노인 약 665만명이 혜택을 받게      │
│ 된다. 월 6만7천원 인상으로 연간 약 80만원의 추가 급여가     │
│ 지급되며, 경기도는 저소득층 대상 월 5만원 추가 지원을       │
│ 검토 중이다.                                                 │
│                                                              │
│ 📌 주요 포인트:                                              │
│ • 2026년 1월부터 기초연금 월 40만원으로 인상                │
│ • 665만명 노인 혜택, 연간 80만원 추가 급여                  │
│ • 주민센터 또는 복지로에서 신청 가능                         │
│ • 경기도 월 5만원 추가 지원 검토                             │
│                                                              │
│ 📄 원본 출처: 5개 기사                                       │
│ • 보건복지부 보도자료 (2025-12-20) 🔗                       │
│ • 기획재정부 예산안 (2025-12-21) 🔗                         │
│ • 연합뉴스 속보 (2025-12-20) 🔗                             │
│ • 경기도 복지정책 (2025-12-21) 🔗                           │
│ • 대한노인회 논평 (2025-12-22) 🔗                           │
│                                                              │
│ 🏷️ 태그: #기초연금 #노인복지 #정책 #인상                   │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ ⭐ 중요도: 8/10   📅 2025-12-18 ~ 2025-12-22                │
│                                                              │
│ 【정책】 독거노인 맞춤돌봄서비스 대상 확대                    │
│                                                              │
│ 💡 AI 통합 요약:                                             │
│ 2026년부터 독거노인 맞춤돌봄서비스 대상이 소득 하위 27%에서  │
│ 65세 이상 전체로 확대되어 약 180만명이 혜택을 받게 된다.    │
│ 서비스 이용자 만족도는 90%를 넘었으며, 서울시는 AI 센서와   │
│ 스마트워치를 활용한 24시간 응급돌봄 서비스를 시작한다.       │
│                                                              │
│ 📌 주요 포인트:                                              │
│ • 독거노인 돌봄 대상 65세 이상 전체로 확대                  │
│ • 월 4회 방문 서비스와 안전확인 제공                         │
│ • 서비스 이용자 만족도 90.3%                                │
│ • 서울시 24시간 AI 기반 응급돌봄 시작                        │
│                                                              │
│ 📄 원본 출처: 3개 기사                                       │
│ • 보건복지부 정책 발표 (2025-12-18) 🔗                      │
│ • 보건복지부 만족도 조사 (2025-12-19) 🔗                    │
│ • 서울시 신규 서비스 공고 (2025-12-22) 🔗                   │
│                                                              │
│ 🏷️ 태그: #노인돌봄 #맞춤돌봄 #독거노인 #정책확대           │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│ ⭐ 중요도: 7/10   📅 2025-12-23 ~ 2025-12-24                │
│                                                              │
│ 【사회서비스원】 경기도사회서비스원 소식                       │
│                                                              │
│ 💡 AI 통합 요약:                                             │
│ 경기도사회서비스원이 2026년 상반기 신규 직원 50명을 공개     │
│ 채용하며, 운영 중인 노인요양시설이 보건복지부 주관 우수      │
│ 돌봄기관으로 선정되었다.                                     │
│                                                              │
│ 📌 주요 포인트:                                              │
│ • 2026년 상반기 신규 직원 50명 채용                         │
│ • 요양보호사 30명, 사회복지사 15명, 간호사 5명              │
│ • 접수: 2026.1.2 ~ 1.15 (온라인)                           │
│ • 우수 돌봄기관 선정                                         │
│                                                              │
│ 📄 원본 출처: 2개 공고                                       │
│ • 채용 공고 (2025-12-23) 🔗                                 │
│ • 수상 소식 (2025-12-24) 🔗                                 │
│                                                              │
│ 🏷️ 태그: #채용 #경기도 #사회서비스원 #우수기관             │
└─────────────────────────────────────────────────────────────┘

📊 통계:
- 처리한 원본 콘텐츠: 10개
- 생성된 큐레이션 콘텐츠: 3개
- 압축률: 70%
- 처리 시간: 45.3초
```

---

## 💰 비용

### OpenAI API 사용량 (일 1회 기준)
- **Embeddings**: $0.02 / 1M tokens
  - 100개 기사 × 500 tokens = 50,000 tokens
  - **일 비용: $0.001** (월 $0.03)
  
- **GPT-4o-mini**: $0.15 / 1M input, $0.60 / 1M output
  - 20개 그룹 × (2,000 input + 500 output) = 50,000 tokens
  - **일 비용: $0.01** (월 $0.30)

### 총 예상 비용
- **일 1회 처리**: 월 $0.33
- **일 2회 처리**: 월 $0.66
- **일 4회 처리**: 월 $1.32

*(실제 비용은 크롤링 콘텐츠 수와 유사도에 따라 달라질 수 있음)*

---

## ✅ 구현 완료 항목

### 핵심 기능
- ✅ OpenAI Embeddings 기반 유사도 계산
- ✅ 유사 콘텐츠 자동 그룹화 (코사인 유사도 85% 이상)
- ✅ GPT-4 기반 중요도 자동 평가 (1-10점)
- ✅ 통합 요약 자동 생성 (3-5문장)
- ✅ 주요 포인트 자동 추출 (3-5개)
- ✅ 데이터베이스 연동 (PostgreSQL)

### 데이터베이스
- ✅ `raw_crawled_contents` 테이블 (원본 데이터)
- ✅ `curation_groups` 테이블 (큐레이션 그룹)
- ✅ `contents` 테이블 확장 (큐레이션 필드)
- ✅ `related_contents` 테이블 (관련 콘텐츠 링크)
- ✅ 인덱스 및 트리거 설정
- ✅ 통계 뷰 (`curation_stats`, `raw_content_processing_stats`)

### 스크립트 및 도구
- ✅ `lib/ai-curator.ts` (핵심 AI 로직)
- ✅ `lib/db-curator.ts` (DB 연동)
- ✅ `lib/scripts/run-curation.ts` (실행 스크립트)
- ✅ `lib/scripts/seed-sample-data.ts` (샘플 데이터)
- ✅ npm scripts 추가 (curate, curate:test, seed:sample 등)

### 문서
- ✅ `CURATION_SETUP_GUIDE.md` (설치 및 사용 가이드)
- ✅ `CURATION_SUMMARY.md` (이 문서)
- ✅ `CURATION_SYSTEM_PLAN.md` (설계 문서)

---

## 🔜 향후 개선 사항

### 1. 관련 콘텐츠 링크 고도화
- [ ] 임베딩 기반 카테고리 간 유사도 검색
- [ ] pgvector 확장 설치 및 적용
- [ ] 관련 자료 자동 추천 알고리즘 개선

### 2. UI/UX 개선
- [ ] 큐레이션 카드 컴포넌트 디자인
- [ ] 원본 출처 펼쳐보기 기능
- [ ] 관련 자료 링크 표시
- [ ] 중요도 배지 및 필터

### 3. 자동화
- [ ] 크롤링 → 큐레이션 자동 파이프라인
- [ ] Cron Job 설정
- [ ] Node.js 스케줄러 (node-cron)

### 4. 성능 최적화
- [ ] 임베딩 캐싱
- [ ] 배치 처리 최적화
- [ ] 병렬 처리

---

## 📞 문의

구현 관련 질문이나 개선 제안은 이슈로 등록해주세요.

**작성일**: 2025-12-25  
**버전**: 1.0.0  
**작성자**: Genspark AI Developer
